{"files":[{"id":"2e25bcaf-d172-4fac-8112-cdd29b413642","name":"Common","type":"server_js","source":"// Total number of ratings per rating sheet\nvar g_rate_count \u003d 5\n\nvar scriptProperties \u003d PropertiesService.getScriptProperties();\nscriptProperties.setProperty(\"currentRound\", \"Round 0 (not started)\");\nscriptProperties.setProperty(\"currentTopic\", \"Entrepreneurship\");\nscriptProperties.setProperty(\"currentQuestion\", \"What do you think the best question is with respect to entrepreneurship?\");\n\nfunction getData() {\n  return scriptProperties.getProperties();\n}\n\nfunction doGet() {\n  // Push variables to template\n  var template \u003d HtmlService.createTemplateFromFile(\u0027index\u0027);\n  template.data \u003d getData();\n  return template.evaluate().setSandboxMode(HtmlService.SandboxMode.IFRAME);\n}\n\nfunction moveRootFileToFolder(filename, foldername)\n{\n  // Hmm, it sometimes returns that the file does not exist even though we just created it\n  // Maybe it takes some time for google to update its caches or something so we wait until it becomes visible\n\n  var folders;\n  do { \n    folders \u003d DriveApp.getFoldersByName(foldername)\n    if (!folders.hasNext())\n      Logger.log(\u0027%s not found!\u0027, foldername);\n  } while (!folders.hasNext());\n  var folder \u003d folders.next();\n  \n  var files;\n  do { \n    files \u003d DriveApp.getRootFolder().getFilesByName(filename)\n    if (!files.hasNext())\n      Logger.log(\u0027%s not found!\u0027, filename);\n  } while (!files.hasNext());\n  \n  var file \u003d files.next();\n  folder.addFile(file);\n  DriveApp.getRootFolder().removeFile(file);\n  return file.getUrl();\n}\n\nfunction beginForm(round, typename)\n{\n  var fileName \u003d \"Round\" + round + typename\n  var form \u003d FormApp.create(fileName + \"Form\");\n  var item \u003d form.addCheckboxItem();\n  item.setTitle(\"Creative Commons Attribution License \").setHelpText(\"I accept content licensed for use under Creative Commons Attribution 3.0 Unported License (c) http://creativecommons.org/licenses/by/3.0/\")\n  item.setChoices([item.createChoice(\"Other than my email address(s), I hereby license all project, discussion and other contributions of other such content under Creative Commons Attribution 3.0 Unported License (c)\")]);\n  item.setRequired(true)\n  return form\n}\n\nfunction endForm(round, class, form, typename)\n{\n  var fileName \u003d \"Round\" + round + typename\n  \n  var ssDest \u003d SpreadsheetApp.create(fileName + \"Results\");\n  form.setDestination(FormApp.DestinationType.SPREADSHEET, ssDest.getId());\n\n  // Move file to folder\n  moveRootFileToFolder(fileName + \"Results\", class);\n  moveRootFileToFolder(fileName + \"Form\", class);\n  \n  formURLs \u003d new Array(1)\n  formURLs[0] \u003d form.getPublishedUrl();\n   return { \n    formURLs: formURLs,\n    spreadsheetURL: ssDest.getUrl()\n  };\n  \n}\n\nfunction getRoundAndStep(class)\n{\n  \n  // Determine round\n  var folders \u003d DriveApp.getFoldersByName(class);\n\n  var folder;\n  if (!folders.hasNext()) {\n    folder \u003d DriveApp.createFolder(class)\n    folder.setSharing(DriveApp.Access.ANYONE, DriveApp.Permission.VIEW);\n   \n    return { \n      round: 1,\n      step: \"Content\"\n    };\n \n  } else \n    folder \u003d folders.next();\n    \n  // Search for files\n  var round \u003d 0;\n  while (folder.getFilesByName(\"Round\" + (round + 1) + \"ContentResults\").hasNext()) {\n    round++;\n  }\n  \n  if (!folder.getFilesByName(\"Round\" + round + \"Rating0Form\").hasNext()) {\n    \n    return { \n      round: round,\n      step: \"Rating\"\n    };\n    \n  } else { \n    \n    return { \n      round: round,\n      step: \"Output\"\n    };\n    \n  }\n  \n}\n\n/*\nfunction getRoundAndStepJSON(class)\n{\n  return JSON.stringify(getRoundAndStep(class)); \n}\n*/\n\nfunction getContentsSheet(class, round)\n{\n  var fileName \u003d \"Round\" + round;\n  \n  // Get folder\n  var folders \u003d DriveApp.getFoldersByName(class);\n  if (!folders.hasNext()) {\n    return;\n  }\n  var folder \u003d folders.next();\n  \n  // Search for content results within the folder\n  var sourceFiles \u003d folder.getFilesByName(fileName + \"ContentResults\")\n  var ss \u003d SpreadsheetApp.open(sourceFiles.next());\n  return ss.getActiveSheet();\n  \n}\n\nfunction getBestRating(round)\n{\n  var fileName \u003d \"Round\" + round;\n \n  var sourceFiles \u003d DriveApp.getFilesByName(fileName + \"RatingResults\");\n  var ss \u003d SpreadsheetApp.open(sourceFiles.next());\n\n  var sheets \u003d ss.getSheets();\n\n  var maxCol \u003d 0;\n  var currentMax \u003d 0;\n  var iMaxSheet \u003d 0;\n  \n  for (var iSheet\u003d0; iSheet\u003csheets.length; iSheet++) {\n    var ssSheet \u003d sheets[iSheet];\n    var r \u003d ssSheet.getDataRange();\n    var col_total \u003d ssSheet.getLastColumn()+1 - 3\n   \n    for (col \u003d 2; col \u003c\u003d ssSheet.getLastColumn(); col++) {\n      var max\u003d0;\n      for (row \u003d 2; row \u003c\u003d ssSheet.getLastRow(); row++) {\n        var c \u003d r.getCell(row, col)\n        if (!c.isBlank()) {\n          var currentVal \u003d r.getCell(row, col).getValue();\n          max \u003d max + currentVal\n        }\n      } \n      if (max \u003e currentMax) {\n        currentMax \u003d max;\n        iMaxSheet \u003d iSheet;\n        maxCol \u003d col\n      }\n    }\n  \n  }\n  \n  var ssSheet \u003d sheets[iMaxSheet];\n  var r \u003d ssSheet.getDataRange();\n  if (!r.getCell(1, maxCol).isBlank())\n    return r.getCell(1, maxCol).getValue();\n\n  return \"\";\n  \n}\n\nfunction shuffle(o) {\n    for(var j, x, i \u003d o.length; i; j \u003d Math.floor(Math.random() * i), x \u003d o[--i], o[i] \u003d o[j], o[j] \u003d x);\n    return o;\n}\n\nfunction makeRatingForm(class, round, columns, delim)\n{\n  var ssSheet \u003d getContentsSheet(class, round);\n\n  var total_responses \u003d ssSheet.getLastRow() - 1;\n  \n  var max_rating_count \u003d Math.min(g_rate_count, total_responses);\n  var totalForms \u003d total_responses / max_rating_count;\n  var remainder \u003d total_responses % max_rating_count;\n  totalForms \u003d Math.floor(totalForms);\n\n  var shuffle_list \u003d new Array(total_responses)\n  for (var i \u003d 2; i\u003c\u003dssSheet.getLastRow(); i++)\n    shuffle_list[i-2] \u003d i\n  shuffle_list \u003d shuffle(shuffle_list)\n \n  var fileNameResults \u003d \"Round\" + round + \"Rating\"\n  var ssDest \u003d SpreadsheetApp.create(fileNameResults + \"Results\");\n  \n  var formURLs \u003d new Array(totalForms)\n  var iNextItem\u003d0;\n  for (var i\u003d0; i\u003ctotalForms; i++) {\n    var fileName \u003d \"Round\" + round + \"Rating\" + i\n    var form \u003d FormApp.create(fileName + \"Form\");\n    form.setTitle(\"Rate the community responses\")\n    form.setShowLinkToRespondAgain(false);\n    form.setDestination(FormApp.DestinationType.SPREADSHEET, ssDest.getId());\n\n    var rating_count \u003d max_rating_count;\n    if (i\u003d\u003dtotalForms-1)\n      rating_count +\u003d remainder;\n    \n    for (var p\u003d0; p\u003crating_count; p++) {\n      var item \u003d form.addScaleItem();\n      \n      var title \u003d \"\";\n      for (var c\u003d0; c\u003ccolumns.length; c++) {\n        if (title!\u003d\"\")\n          title +\u003d delim;\n        title +\u003d ssSheet.getRange(columns[c] + shuffle_list[iNextItem]).getValue()\n      }\n      \n      item.setTitle(title).setBounds(1, 5);\n      item.setRequired(true);\n      iNextItem++;\n    }\n   \n    formURLs[i] \u003d form.getPublishedUrl();\n   \n    moveRootFileToFolder(fileName + \"Form\", class);\n     \n }\n \n  // Move file to folder\n  moveRootFileToFolder(fileNameResults + \"Results\", class);\n \n  return { \n    formURLs: formURLs,\n    spreadsheetURL: ssDest.getUrl()\n  }; \n \n}\n\nfunction nextRound(class, title, question, querytype, querytypedata) {\n \n  var info \u003d getRoundAndStep(class);\n  var urls;\n\n  switch(info.step) {\n    case \"Content\":\n      switch(querytype) {\n        case \"TitleOnly\":\n          urls \u003d makeStartForm_TitleOnly(class, info.round, title, question)\n          break;\n         case \"TitleAndBlurb\":\n          urls \u003d makeStartForm_TitleAndBlurb(class, info.round, title, question)\n          break;\n         case \"DropDownList\":\n          urls \u003d makeStartForm_DropDownList(class, info.round, title, question, querytypedata)\n          break;\n         case \"2TextBoxes\":\n          urls \u003d makeStartForm_2TextBoxes(class, info.round, title, question, querytypedata)\n          break;\n         case \"3TextBoxes\":\n          urls \u003d makeStartForm_3TextBoxes(class, info.round, title, question, querytypedata)\n          break;\n         case \"4TextBoxes\":\n          urls \u003d makeStartForm_4TextBoxes(class, info.round, title, question, querytypedata)\n          break;\n      }\n       \n      break;\n      \n    case \"Rating\":\n      scriptProperties.setProperty(\"currentRound\", \"Round \"+info.round+\" (receiving answers)\");\n\n      switch(querytype) {\n        case \"TitleOnly\":\n         urls \u003d makeRatingForm_TitleOnly(class, info.round);\n          break;\n         case \"TitleAndBlurb\":\n          urls \u003d makeRatingForm_TitleAndBlurb(class, info.round);\n          break;\n         case \"DropDownList\":\n          urls \u003d makeRatingForm_DropDownList(class, info.round);\n          break;\n         case \"2TextBoxes\":\n          urls \u003d makeRatingForm_2TextBoxes(class, info.round);\n          break;\n         case \"3TextBoxes\":\n          urls \u003d makeRatingForm_3TextBoxes(class, info.round);\n          break;\n         case \"4TextBoxes\":\n          urls \u003d makeRatingForm_4TextBoxes(class, info.round);\n          break;\n        }\n    \n      break;\n      \n    case \"Output\":\n      scriptProperties.setProperty(\"currentRound\", \"Round \"+info.round+\" (rating answers)\");\n\n      switch(querytype) {\n        case \"TitleOnly\":\n          urls \u003d makeOutputForm_TitleOnly(class, info.round, question);\n          break;\n         case \"TitleAndBlurb\":\n          urls \u003d makeOutputForm_TitleAndBlurb(class, info.round, question);\n          break;\n         case \"DropDownList\":\n          urls \u003d makeOutputForm_DropDownList(class, info.round, question, querytypedata);\n          break;\n         case \"2TextBoxes\":\n          urls \u003d makeOutputForm_2TextBoxes(class, info.round, question, querytypedata);\n          break;\n         case \"3TextBoxes\":\n          urls \u003d makeOutputForm_3TextBoxes(class, info.round, question, querytypedata);\n          break;\n         case \"4TextBoxes\":\n          urls \u003d makeOutputForm_4TextBoxes(class, info.round, question, querytypedata);\n          break;\n     }         \n\n      break;\n  }\n    \n  if (info.step \u003d\u003d \"Content\" \u0026\u0026 info.round \u003d\u003d 1) {\n    var urlHTML \u003d generateClientPage(class)\n    generateClientRoundJavascript(info.round, urls.formURLs, urls.spreadsheetURL, class)\n    return urlHTML;\n  } else {\n    generateClientRoundJavascript(info.round, urls.formURLs, urls.spreadsheetURL, class)\n    return urls.formURLs[0];  \n  }\n  \n}\n\nfunction driveURLToHostURL(file)\n{\n  // Need to convert URL to a direct hosted one\n  // From: https://drive.google.com/file/d/0Bxfp8kR0xRi9YXUtZ0N0b0ZUaVE/view?usp\u003ddrivesdk\n  // To: https://www.googledrive.com/host/0Bxfp8kR0xRi9Q095YlBpT0I3aGs\n   \n  return \"https://www.googledrive.com/host/\" + file.getId();\n \n}\n\nfunction generateClientRoundJavascript(round, formURLs, resultsURL, class)\n{\n  // Here we write out a little javascript file with variables\n  // set to things we want to show on the client side\n  // We import this javascript in the client webpage and use\n  // the variables defined to set things up\n  \n  var folders;\n  do { \n    folders \u003d DriveApp.getFoldersByName(class)\n    if (!folders.hasNext())\n      Logger.log(\u0027%s not found!\u0027, foldername);\n  } while (!folders.hasNext());\n  var folder \u003d folders.next();\n  \n  var files \u003d folder.getFilesByName(\"IdeaRankLink.js\")\n  var file \u003d files.next();\n  \n  var jsContents;\n  jsContents \u003d \"var round \u003d \" + round + \";\\n\";\n  \n  var formArrayString \u003d \"[\";\n  for (var i\u003d0; i\u003cformURLs.length; i++) {\n    if (i\u003e0)\n      formArrayString +\u003d \", \";\n    formArrayString +\u003d \"\\\"\" + formURLs[i] + \"\\\"\";\n  }\n  formArrayString +\u003d \"]\";\n\n  jsContents +\u003d \"var form_srcs \u003d \" + formArrayString + \";\\n\";\n  jsContents +\u003d \"var results_src \u003d \\\"\" + resultsURL + \"\\\";\\n\";\n  \n  file.setContent(jsContents) \n  \n}\n\nfunction generateClientPage(class)\n{\n \n   // Open template\n  var templateFiles \u003d DriveApp.getFilesByName(\"IdeaRankClientTemplate.html\");\n  if (!templateFiles.hasNext()) {\n    Logger.log(\"IdeaRankClientTemplate.html file not found!\");\n    return;\n  }\n  \n  var folders \u003d DriveApp.getFoldersByName(class);\n\n  var folder;\n  if (!folders.hasNext()) {\n    folder \u003d DriveApp.createFolder(class)\n    folder.setSharing(DriveApp.Access.ANYONE, DriveApp.Permission.VIEW);\n  } else \n    folder \u003d folders.next();\n    \n  var jsFiles \u003d folder.getFilesByName(\"IdeaRankLink.js\")\n  \n  // Create file if it doesn\u0027t exist\n  var jsFile;\n  if (!jsFiles.hasNext()) {\n    jsFile \u003d folder.createFile(\"IdeaRankLink.js\", \"\");\n  } else\n    jsFile \u003d jsFiles.next(); \n  \n\n  // Generate client html file\n  var htmlFiles \u003d folder.getFilesByName(\"IdeaRank.html\")\n  \n  // Create file if it doesn\u0027t exist\n  var htmlFile;\n  if (!htmlFiles.hasNext()) {\n    htmlFile \u003d folder.createFile(\"IdeaRank.html\", \"\", MimeType.HTML);\n  } else\n    htmlFile \u003d htmlFiles.next();\n  \n  var strTemplate \u003d templateFiles.next().getAs(\u0027text/plain\u0027).getDataAsString();\n  strTemplate \u003d strTemplate.replace(\"JAVASCRIPT_LINK_PLACEHOLDER\", driveURLToHostURL(jsFile))\n \n  htmlFile.setContent(strTemplate)\n\n  return driveURLToHostURL(htmlFile)\n   \n}\n\nfunction test()\n{\n  generateClientPage(\"RAH\")\n  nextRound(\"RAH\", \"title\", \"question\", \"TitleOnly\", \"querytypedata\");\n}\n"},{"id":"8f52f130-5f14-40a1-a687-6a7118aa127f","name":"index","type":"html","source":"\u003c!DOCTYPE html\u003e\n\u003chtml\u003e\n  \u003chead\u003e\n    \u003c!--Import Google Icon Font--\u003e \n    \u003clink href\u003d\"https://fonts.googleapis.com/icon?family\u003dMaterial+Icons\" rel\u003d\"stylesheet\"\u003e \n\n    \u003c!--Import materialize css compiled and minified --\u003e\n    \u003clink rel\u003d\"stylesheet\" href\u003d\"https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.5/css/materialize.min.css\"\u003e\n    \n    \u003cbase target\u003d\"_top\"\u003e\n    \u003cscript\u003e\n    \n      function onRoundLoaded(link) {\n        document.getElementById(\u0027URL\u0027).setAttribute(\"href\", link);\n        document.getElementById(\u0027URLText\u0027).innerHTML \u003d link;\n        document.getElementById(\"roundbutton\").disabled \u003d false;\n //       updateUIForRound();\n      }\n                      \n      function doRound() {\n      \n        var queryclass \u003d document.getElementById(\u0027Class\u0027).value;\n        var topic \u003d document.getElementById(\u0027Topic\u0027).value;\n        var question \u003d document.getElementById(\u0027Question\u0027).value;\n        var querytype \u003d document.getElementById(\u0027QueryType\u0027).value;   \n        var querytypedata \u003d document.getElementById(\u0027QueryTypeData\u0027).value;   \n         \n        google.script.run\n        .withSuccessHandler(onRoundLoaded)\n        .nextRound(queryclass, topic, question, querytype, querytypedata) \n        \n        document.getElementById(\u0027URL\u0027).setAttribute(\"href\", \"#\");\n        document.getElementById(\u0027URLText\u0027).innerHTML \u003d \"(loading...)\";\n        document.getElementById(\"roundbutton\").disabled \u003d true;\n        \n      }\n          \n      function onTopRatedReady(topratings) {\n     \n            var v \u003d JSON.parse(topratings);\n            $(\"#tabsCollectionDiv\").html(\u0027\u0027)\n            for(i\u003d0; i\u003cv.length; i++) {\n               $(\"#tabsCollectionDiv\").append(\"\u003cdiv id\u003d\u0027\"+v[i]+\"\u0027 class\u003d\u0027col s12\u0027\u003e\"+v[i]+\"\u003c/div\u003e\");\n      }\n\n  }\n\n/*\n    function onUpdateUIForRound(step)\n     {\n     \n     var v \u003d JSON.parse(step);\n\n      switch(v.step) {\n      case \"Output\":\n      case \"Content\":\n         document.getElementById(\"populatebutton\").disabled \u003d true;\n     \n      break;\n      case \"Rating\":\n         document.getElementById(\"populatebutton\").disabled \u003d false;\n      \n      break;\n      \n      }\n\n     }\n\n     function updateUIForRound() {\n\n        var queryclass \u003d document.getElementById(\u0027Class\u0027).value;\n\n        google.script.run\n        .withSuccessHandler(onUpdateUIForRound)\n        .getRoundAndStepJSON(queryclass) \n\n\n      }\n*/\n     \n \n      function getTopRated() {\n        \n        var queryclass \u003d document.getElementById(\u0027Class\u0027).value;\n        \n        google.script.run\n        .withSuccessHandler(onTopRatedReady)\n        .getBestRatings(queryclass, 10);\n   \n      }\n      \n      \n    \u003c/script\u003e\n  \u003c/head\u003e\n  \u003cbody\u003e\n      \u003cdiv class\u003d\"white-text light-blue lighten-1 center-align\"\u003e\n        \u003ch2\u003eUnworkshop\u003c/h2\u003e\n      \u003c/div\u003e\n    \n    \u003cdiv class\u003d\"section no-pad-bot\" id\u003d\"index-banner\"\u003e\n    \u003cdiv class\u003d\"container\"\u003e\n    \u003cbr /\u003e\u003cbr /\u003e\n    \u003cdiv class\u003d\"row center\"\u003e\n    \n    \u003c!-- Form to register a project --\u003e\n    \u003cdiv class\u003d\"col s12\"\u003e\n      \u003c!-- Event --\u003e\n      \u003cdiv class\u003d\"row\"\u003e\n        \u003cdiv class\u003d\"input-field col s12\"\u003e\n          \u003cinput id\u003d\"Class\" name\u003d\"Class\" type\u003d\"text\" value\u003d\"Maker Series\" /\u003e\n          \u003clabel for\u003d\"Class\"\u003eEvent (Google folder will be created with this name)\u003c/label\u003e\n        \u003c/div\u003e\n      \u003c/div\u003e\n      \n      \u003c!-- Topic --\u003e\n      \u003cdiv class\u003d\"row\"\u003e\n        \u003cdiv class\u003d\"input-field col s12\"\u003e\n          \u003cinput id\u003d\"Topic\" name\u003d\"Topic\" type\u003d\"text\" value\u003d\"First Round General Topic\" /\u003e\n          \u003clabel for\u003d\"Topic\"\u003eCurrent topic (a form will be created with this title):\u003c/label\u003e\n        \u003c/div\u003e\n      \u003c/div\u003e\n       \n    \u003c!-- Question --\u003e\n      \u003cdiv class\u003d\"row\"\u003e\n        \u003cdiv class\u003d\"input-field col s12\"\u003e\n          \u003ctextarea id\u003d\"Question\" name\u003d\"Question\" class\u003d\"materialize-textarea\" rows\u003d\"8\" cols\u003d\"40\"\u003eFirst round specific question\u003c/textarea\u003e\n          \u003clabel for\u003d\"Question\"\u003eQuestion to the audience:\u003c/label\u003e\n        \u003c/div\u003e\n      \u003c/div\u003e\n \n       \u003c!-- Query type --\u003e\n      \u003cdiv class\u003d\"row\"\u003e\n        \u003cdiv class\u003d\"input-field col s12\"\u003e\n        \u003cselect id\u003d\"QueryType\"\u003e\n        \u003coption value\u003d\"TitleOnly\" selected\u003eTitle only\u003c/option\u003e\n        \u003coption value\u003d\"TitleAndBlurb\"\u003eTitle + blurb \u003c/option\u003e\n        \u003coption value\u003d\"2TextBoxes\"\u003e2 text boxes\u003c/option\u003e\n        \u003coption value\u003d\"3TextBoxes\"\u003e3 text boxes\u003c/option\u003e\n        \u003coption value\u003d\"4TextBoxes\"\u003e4 text boxes\u003c/option\u003e\n        \u003coption value\u003d\"DropDownList\"\u003eDrop-down list of options\u003c/option\u003e\n        \u003c/select\u003e\n        \u003clabel\u003eChoose query input type here if needed:\u003c/label\u003e\n        \u003c/div\u003e\n      \u003c/div\u003e\n      \n        \u003c!-- Query values --\u003e\n      \u003cdiv class\u003d\"row\"\u003e   \u003c!-- style\u003d\"visibility: hidden\" --\u003e\n        \u003cdiv class\u003d\"input-field col s12\"\u003e\n          \u003cinput id\u003d\"QueryTypeData\" name\u003d\"QueryTypeData\" type\u003d\"text\" value\u003d\"Option1,Option2,Option3\" /\u003e\n          \u003clabel for\u003d\"QueryTypeData\"\u003eDrop-down query input type list items. Seperate items with a comma.\u003c/label\u003e\n       \u003c/div\u003e\n      \u003c/div\u003e\n\n      \u003cbr /\u003e\n      \u003cbutton id\u003d\"roundbutton\" class\u003d\"btn btn-lg btn-primary\" type\u003d\"button\" onclick\u003d\"doRound()\"\u003eProceed\u003c/button\u003e\n      \u003cbr /\u003e\n      \n      \u003cp\u003e\u003ca id\u003d\"URL\" href\u003d\"\" target\u003d\"blank\" class\u003d\"\"\u003e\n        \u003cspan id\u003d\"URLText\"\u003e\u003c/span\u003e\n      \u003c/a\u003e\u003c/p\u003e\n      \u003cbr /\u003e\n      \n      \u003cbutton id\u003d\"populatebutton\" class\u003d\"btn btn-lg btn-primary\" type\u003d\"button\" onclick\u003d\"getTopRated()\"\u003ePopulate Top Rated\u003c/button\u003e\n    \n      \u003cdiv class\u003d\"row\"\u003e\n\n        \u003cdiv class\u003d\"row\"\u003e\n          \u003cbr /\u003e\n          \u003cdiv id\u003d\"tabsCollectionDiv\"\u003e\n          \u003c/div\u003e\n        \u003c/div\u003e\n      \u003c/div\u003e\n      \n    \u003c/div\u003e\n    \u003c/div\u003e\n    \u003c/div\u003e\n    \u003c/div\u003e\n    \n    \n    \u003c!-- Import scripts --\u003e\n    \u003cscript type\u003d\"text/javascript\" src\u003d\"https://code.jquery.com/jquery-2.1.1.min.js\"\u003e\u003c/script\u003e\n    \u003cscript src\u003d\"https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.5/js/materialize.min.js\"\u003e\u003c/script\u003e\n    \n    \u003cscript\u003e\n   $(document).ready(function() {\n    $(\u0027select\u0027).material_select();\n    }); \n    \n    \u003c/script\u003e\n    \n  \u003c/body\u003e\n\u003c/html\u003e"},{"id":"16dffee8-47b8-4454-be2c-de0bcc2049e1","name":"TitleOnly","type":"server_js","source":"\n// Create first form of the event\nfunction makeStartForm_TitleOnly(class, round, title, question)\n{\n \n  var form \u003d beginForm(round, \"Content\");\n  \n  form.setTitle(title);\n  form.addTextItem().setTitle(question).setRequired(true);\n\n  return endForm(round, class, form, \"Content\");\n\n}\n\nfunction makeRatingForm_TitleOnly(class, round)\n{\n  return makeRatingForm(class, round, [\"C\"], \"\");\n}\n\nfunction makeOutputForm_TitleOnly(class, round, title)\n{\n  return makeStartForm_TitleOnly(class, round+1, getBestRating(round), title);\n}\n\n"},{"id":"30b10f6a-03a9-46d7-9a4f-769fb23b01d2","name":"TitleAndBlurb","type":"server_js","source":"\n// Create first form of the event\nfunction makeStartForm_TitleAndBlurb(class, round, title, question)\n{\n \n  var form \u003d beginForm(round, \"Content\");\n  \n  form.setTitle(title);\n  form.addTextItem().setTitle(question).setRequired(true);\n  form.addParagraphTextItem().setTitle(\"Expand on your question\").setRequired(true);\n\n  return endForm(round, class, form, \"Content\");\n\n}\n\nfunction makeRatingForm_TitleAndBlurb(class, round)\n{\n  return makeRatingForm(class, round, [\"C\",\"D\"], \": \");\n}\n\nfunction makeOutputForm_TitleAndBlurb(class, round, title)\n{\n  return makeStartForm_TitleAndBlurb(class, round+1, getBestRating(round), title);\n}\n"},{"id":"56cbaf1c-8e5c-4597-9296-7c810f061939","name":"DropDownList","type":"server_js","source":"\n// Create first form of the event\nfunction makeStartForm_DropDownList(class, round, title, question, querytypedata)\n{\n \n  var items \u003d querytypedata.split(\",\")\n  \n  var form \u003d beginForm(round, \"Content\");\n  form.addTextItem().setTitle(question).setRequired(true);\n  form.setTitle(title);\n  var item \u003d form.addListItem();\n  item.setTitle(\"Select one of the following\");\n  item.setRequired(true);\n\n  var choices \u003d new Array(items.length);\n  for (i\u003d0; i\u003citems.length; i++) {\n    choices[i] \u003d item.createChoice(items[i].trim());\n  }\n\n  item.setChoices(choices);\n  \n  return endForm(round, class, form, \"Content\");\n\n}\n\nfunction makeRatingForm_DropDownList(class, round)\n{\n  return makeRatingForm(class, round, [\"C\",\"D\"], \"---\");\n}\n\nfunction makeOutputForm_DropDownList(class, round, title, querytypedata)\n{\n  return makeStartForm_DropDownList(class, round+1, getBestRating(round), title, querytypedata);\n}\n\n"},{"id":"cd1b321d-89c5-4bd9-91e0-f085e9b5181d","name":"2TextBoxes","type":"server_js","source":"\n// Create first form of the event\nfunction makeStartForm_2TextBoxes(class, round, title, question)\n{\n \n  var form \u003d beginForm(round, \"Content\");\n  \n  form.setTitle(title);\n  form.addTextItem().setTitle(question).setRequired(true);\n  form.addTextItem().setRequired(true);\n\n  return endForm(round, class, form, \"Content\");\n\n}\n\nfunction makeRatingForm_2TextBoxes(class, round)\n{\n  return makeRatingForm(class, round, [\"C\",\"D\"], \", \");\n}\n\nfunction makeOutputForm_2TextBoxes(class, round, title)\n{\n  return makeStartForm_2TextBoxes(class, round+1, getBestRating(round), title);\n}\n\n"},{"id":"7a2b69c5-bc65-4f11-a709-f6fdcf87ad18","name":"3TextBoxes","type":"server_js","source":"\n// Create first form of the event\nfunction makeStartForm_3TextBoxes(class, round, title, question)\n{\n \n  var form \u003d beginForm(round, \"Content\");\n  \n  form.setTitle(title);\n  form.addTextItem().setTitle(question).setRequired(true);\n  form.addTextItem().setRequired(true);\n  form.addTextItem().setRequired(true);\n\n  return endForm(round, class, form, \"Content\");\n\n}\n\nfunction makeRatingForm_3TextBoxes(class, round)\n{\n  return makeRatingForm(class, round, [\"C\",\"D\",\"E\"], \", \");\n}\n\nfunction makeOutputForm_3TextBoxes(class, round, title)\n{\n  return makeStartForm_3TextBoxes(class, round+1, getBestRating(round), title);\n}\n\n"},{"id":"de011f2a-8c18-40f0-a3f5-48b1f67f5f14","name":"4TextBoxes","type":"server_js","source":"\n// Create first form of the event\nfunction makeStartForm_4TextBoxes(class, round, title, question)\n{\n \n  var form \u003d beginForm(round, \"Content\");\n  \n  form.setTitle(title);\n  form.addTextItem().setTitle(question).setRequired(true);\n  form.addTextItem().setRequired(true);\n  form.addTextItem().setRequired(true);\n  form.addTextItem().setRequired(true);\n\n  return endForm(round, class, form, \"Content\");\n\n}\n\nfunction makeRatingForm_4TextBoxes(class, round)\n{\n  return makeRatingForm(class, round, [\"C\",\"D\",\"E\",\"F\"], \", \");\n}\n\nfunction makeOutputForm_4TextBoxes(class, round, title)\n{\n  return makeStartForm_4TextBoxes(class, round+1, getBestRating(round), title);\n}\n\n"},{"id":"e46daee2-5453-4a1d-8676-818683782940","name":"GetTopRated","type":"server_js","source":"\nfunction getBestRatings(class, numtoget)\n{\n  // Get info on round and step\n  var info \u003d getRoundAndStep(class);\n  var fileName \u003d \"Round\" + info.round;\n  \n  // Get folder\n  var folders \u003d DriveApp.getFoldersByName(class);\n  if (!folders.hasNext()) {\n    return JSON.stringify([\u0027There is no \"\u0027+class+\u0027\" folder.\u0027]);\n  }\n  var folder \u003d folders.next();\n  \n  // Search for rating results within the folder\n  var sourceFiles \u003d folder.getFilesByName(fileName + \"RatingResults\");\n  if (!sourceFiles.hasNext()) {\n    return JSON.stringify([\u0027There are no rating results for round \u0027+info.round+\u0027 within the \"\u0027+class+\u0027\" folder. Initiate a rating round to see the results.\u0027]);\n  }\n  var ss \u003d SpreadsheetApp.open(sourceFiles.next());\n\n  var sheets \u003d ss.getSheets();\n\n  var maxCol \u003d 0;\n  var currentMax \u003d 0;\n  var iMaxSheet \u003d 0;\n  \n  var totals \u003d new Array();\n  \n  for (var iSheet\u003d0; iSheet\u003csheets.length; iSheet++) {\n    var ssSheet \u003d sheets[iSheet];\n    var r \u003d ssSheet.getDataRange();\n    var col_total \u003d ssSheet.getLastColumn()+1 - 3\n   \n    for (col \u003d 2; col \u003c\u003d ssSheet.getLastColumn(); col++) {\n      var max\u003d0;\n      for (row \u003d 2; row \u003c\u003d ssSheet.getLastRow(); row++) {\n        var c \u003d r.getCell(row, col)\n        if (!c.isBlank()) {\n          var currentVal \u003d r.getCell(row, col).getValue();\n          max \u003d max + currentVal\n        }\n      } \n\n      if (!r.getCell(1, col).isBlank()) {\n        var item \u003d new Array(2);\n        item[\u0027item\u0027] \u003d r.getCell(1, col).getValue() + \" (Rating: \" + max + \")\";\n        item[\u0027total\u0027] \u003d max;\n        totals.push(item);\n      }\n                  \n    }\n      \n  }\n   \n totals \u003d totals.sort(function(a,b){return b.total-a.total});\n \n totals \u003d totals.slice(0,Math.min(numtoget, totals.length));\n  \n  var v \u003d new Array;\n  for (var i\u003d0; i\u003ctotals.length; i++) {\n    v.push(totals[i].item)\n   \n  }\n  \n return JSON.stringify(v);\n  \n}\n"}]}